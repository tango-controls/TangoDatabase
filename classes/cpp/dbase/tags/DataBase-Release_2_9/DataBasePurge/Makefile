#=============================================================================
#
# file :        Makefile
#
# description : Include for the DataBasePurge class.
#
# project :     Makefile to generate a Tango server
#
# $Author$
#
# $Revision$
#
# $Log$
#
# copyleft :    European Synchrotron Radiation Facility
#               BP 220, Grenoble 38043
#               FRANCE
#
#=============================================================================
#  		This file is generated by POGO
#	(Program Obviously used to Generate tango Object)
#
#         (c) - Software Engineering Group - ESRF
#=============================================================================
#

CLASS    = DataBasePurge
RELEASE  = Release_1_0

#-----------------------------------------
#	Set default home directories
#-----------------------------------------

TANGO_HOME   =  /segfs/tango
CPP_SERVERS  =  $(TANGO_HOME)/cppserver
MYSQL_BASE   = /usr/local

ifdef no_debug
	DEBUG = -O
else
	DEBUG = -g
endif

ifdef _solaris
CC = CC
BIN_DIR=$(shell /csadmin/common/scripts/get_os)_CC
endif

ifdef linux
CC = c++
AR = ar
BIN_DIR=$(shell /csadmin/common/scripts/get_os)
endif

INCLUDE_DIRS =  -I$(TANGO_HOME)/include/$(BIN_DIR)	-I.	\
                -I$(CPP_SERVERS)/include \
		-I$(MYSQL_BASE)/mysql/include
LIB_DIRS     =  -L $(MYSQL_BASE)/mysql/lib \
		-L $(TANGO_HOME)/lib/$(BIN_DIR)

TARGET_LIB = $(CPP_SERVERS)/lib/$(BIN_DIR)/libtgclasses.a


#-----------------------------------------
#	Set  CXXFLAGS and LFLAGS
#-----------------------------------------
ifdef _solaris
CXXFLAGS =  $(DEBUG) -mt -D_PTHREADS $(INCLUDE_DIRS)
LFLAGS =  $(DEBUG) $(LIB_DIRS)  		\
				-ltango			\
				-llog4tango		\
				-lomniORB4 		\
				-lomniDynamic4	\
				-lomnithread	\
				-lCOS4			\
				-lmysqlclient	\
				-lz			\
				-lpthread		\
				-lposix4 -lsocket -lnsl
endif

ifdef linux
CXXFLAGS =  $(DEBUG) -D_REENTRANT $(INCLUDE_DIRS)
LFLAGS =  $(DEBUG) $(LIB_DIRS)  		\
				-ltango			\
				-llog4tango		\
				-lomniORB4 		\
				-lomniDynamic4	\
				-lomnithread	\
				-lmysqlclient	\
				-lz			\
				-lCOS4			\
				-ldl -lpthread
endif




#-----------------------------------------
#	Set  dependences
#-----------------------------------------
SVC_OBJS = 	main.o	\
		ClassFactory.o	\
		$(CLASS)Class.o	\
		$(CLASS)StateMachine.o	\
		$(CLASS).o \
		PurgeThread.o

SVC_INC = 	$(CLASS)Class.h \
		$(CLASS).h	\
		PurgeThread.h


%.o: %.cpp $(SVC_INC)
	$(CC) $(CXXFLAGS) -c $<
			


#-----------------------------------------
#	Make Entry
#-----------------------------------------
all: $(CLASS)

$(CLASS):	$(SVC_OBJS)
	$(CC) $(SVC_OBJS) -o $(CLASS) $(LFLAGS)


clean:
	rm -f *.o $(CLASS) core
	
#-----------------------------------------
#	Install binary file
#-----------------------------------------
install:
	cp $(CLASS) $(TANGO_HOME)/bin/$(BIN_DIR)

#-----------------------------------------
#	Update class library and header files
#	recompile without debug mode.
#-----------------------------------------
lib: clean
	@make no_debug=1
	cp *.h $(CPP_SERVERS)/include
	ar ruv $(TARGET_LIB) $(CLASS).o
	ar ruv $(TARGET_LIB) $(CLASS)Class.o
	ar ruv $(TARGET_LIB) $(CLASS)StateMachine.o
	ident  $(TARGET_LIB)

#----------------------------------------------------
#	Tag the CVS module corresponding to this class
#----------------------------------------------------
tag:
	@cvstag "$(CLASS)-$(RELEASE)"
	@make   $(CLASS)
	@make show_tag

show_tag:
	@cvstag -d 
